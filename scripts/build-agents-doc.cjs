#!/usr/bin/env node

/**
 * Script to build AGENTS.md from individual markdown files in docs/agents/
 *
 * Usage: node scripts/build-agents-doc.cjs
 */

const fs = require('fs');
const path = require('path');

const DOCS_DIR = path.join(__dirname, '..', 'docs', 'agents');
const OUTPUT_FILE = path.join(__dirname, '..', 'AGENTS.md');

// Order of files to include (based on filename prefix)
const FILE_ORDER = [
  '01-package-manager.md',
  '02-project-stack.md',
  '03-development-guidelines.md',
  '04-file-structure.md',
  '05-scripts-commands.md',
  '06-code-quality.md',
  '07-testing-practices.md',
  '08-typescript-conventions.md',
  '09-folder-architecture.md',
  '10-documentation.md',
];

function buildAgentsDoc() {
  console.log('Building AGENTS.md from docs/agents/...');

  const header = `<!--
  ⚠️ WARNING: This file is automatically generated!

  Do not edit this file manually.
  All changes must be made in the .md files in the docs/agents/ folder
  After making changes, run: pnpm run build:agents
-->

# Lago Billing System - Development Assistant

You are an expert development assistant for the Lago billing system project. Always follow these critical guidelines:

`;

  const sections = [header];

  for (const filename of FILE_ORDER) {
    const filePath = path.join(DOCS_DIR, filename);

    if (!fs.existsSync(filePath)) {
      console.warn(`Warning: File ${filename} not found, skipping...`);
      continue;
    }

    const content = fs.readFileSync(filePath, 'utf-8');
    sections.push(content);
  }

  const fullContent = sections.join('\n\n');

  fs.writeFileSync(OUTPUT_FILE, fullContent, 'utf-8');
  console.log(`✅ Successfully built AGENTS.md (${fullContent.length} characters)`);
}

if (require.main === module) {
  buildAgentsDoc();
}

module.exports = { buildAgentsDoc };
